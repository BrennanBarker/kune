{% extends templated_html %}
{% block sync_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ==" crossorigin="anonymous"></script>

<script type="text/javascript" charset="utf-8">
    function main() {
        var socket = io(); // Connect to the Socket.IO server.
        
        {% if session['is_leader'] %}
        // Send a message to the server when a hash changes
        function notify_server(event) {
            socket.emit('hash_change', {data: location.hash});
        };
        window.addEventListener('hashchange', notify_server);
        {% endif %}
            
        // If the server messages that the cursor has changed, change location
        function sync_anchor(msg, cb) {
            if (location.hash != msg.data) { location.hash = msg.data };
        };
        socket.on('updated_cursor', sync_anchor);
    };

    if ( 
        document.readyState === "complete" ||
        (document.readyState !== "loading" && !document.documentElement.doScroll)
    ) { 
        main(); 
    } else {
        document.addEventListener("DOMContentLoaded", main); 
    };
</script>
{% endblock %}